/**
 * @description 结合jquery+百度ueditor1.4.3.1(修改版)做一个自定义文件上传工具
 * @date 2015-10-11
 * @author 张强
 */(function(b){function l(a){var c=this,d=b.data(c,"uploader");d?b.extend(d.options,a):d=b.data(c,"uploader",{options:a});b(this).addClass("uploader-waitter-box").addClass(a.btnStyle+"-content").width(a.width);var f=b("\x3cdiv class\x3d'uploader-select-btn button "+a.btnStyle+"'\x3e\x3ci class\x3d'"+a.config[a.type].iconCls+" '\x3e\x3c/i\x3e\x26nbsp;\x26nbsp;"+a.config[a.type].btnText+"\x3c/div\x3e").appendTo(b(c)),d=b("\x3cdiv class\x3d'uploader-container no-list'\x3e\x3c/div\x3e").appendTo(b(c));b("\x3cscript id\x3d'"+a.El.id+"-editor' type\x3d'text/plain' style\x3d'display:none;'\x3e\x3c/script\x3e").appendTo(b(c));var g=UE.getEditor(a.El.id+"-editor",{toolbars:[[a.config[a.type].eventName]]});"auto"!=a.height&&d.css({height:a.height+"px",overflow:"auto"});b.data(c,"component")?b.extend(b.data(c,"component"),{btn:f,container:d}):b.data(c,"component",{btn:f,container:d});g.ready(function(){g.hide();var d="beforeInsertImage";switch(a.type){case "media":d="beforeInsertMedia";break;case "file":d="beforeInsertFile"}g.addListener(d,function(d,g){var f=[];b.each(g,function(b,c){f.push(new m(c.url||c.src,c.title,a.editable,a.deleteable,null,null))});k.call(c,f);return"stop"});f.bind("click",function(){switch(a.type){case "image":n.call(c,g);break;case "media":p.call(c,g);break;case "file":q.call(c,g)}})});b(this).show()}function n(a){b(this).find(".edui-for-insertimage .edui-button-body")[0].click()}function p(a){b(this).find(".edui-for-insertvideo .edui-button-body")[0].click()}function q(a){b(this).find(".edui-for-attachment .edui-button-body")[0].click()}function m(a,b,d,f,g,e){this.id=e;this.url=a;this.title=b;this.editable=d;this.deleteable=f;this.dom=g}function k(a){var c=this,d=b.data(c,"data"),d=d?b.data(c,"data",d.concat(a)):b.data(c,"data",a);b.each(a,function(a,d){var e=b.data(c,"component").container.width();"auto"!=b.data(c,"uploader").options.height&&(e-=10);var h=b("\x3cdiv style\x3d'width:"+(e-3)+"px' itemid\x3d'uploader-itemid-"+d.id+"' class\x3d'uploader-item-box-container "+b.data(c,"uploader").options.btnStyle+"-item'\x3e\x3cinput type\x3d'hidden' value\x3d'"+d.id+"'/\x3e\x3cdiv class\x3d'uploader-item-url'\x3e"+d.url+"\x3c/div\x3e\x3cdiv class\x3d'uploader-item-delbtn'\x3e\x3ci class\x3d'fa fa-trash fa-lg'\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d'uploader-item-title'\x3e\x3cinput type\x3d'text' required\x3dtrue class\x3d'title-input "+b.data(c,"uploader").options.btnStyle+"-input'/\x3e\x3c/div\x3e\x3c/div\x3e").appendTo(b.data(c,"component").container);d.dom=h;b.data(c,"uploader").options.deleteable?h.find(".uploader-item-delbtn").bind("click",function(){var a=b.data(c,"data");a&&b.each(a,function(f,e){d==e&&(a.remove(f),b.data(c,"data",a))});h.remove()}):h.find(".uploader-item-delbtn").hide();e=h.find(".uploader-item-title input");e.textbox({value:d.title,onChange:function(a,f){var e=b.data(c,"data");b.each(e,function(b,c){c.id==d.id&&(c.title=a)})}});b.data(c,"uploader").options||(e.textbox("readonly",!0),h.find(".uploader-item-title").find("input").addClass("diabled-input"))})}b.fn.ueuploader=function(a,c){if("string"==typeof a&&""!=a)return b.fn.ueuploader.methods[a].call(this[0],c);var d;d=b(this).attr("data-options");d=void 0==d?{}:eval("({"+d+"})");a=b.extend({type:"image",btnStyle:"white",allowFiles:{},config:{image:{btnText:"\u70b9\u51fb\u9009\u62e9\u56fe\u7247\u2026",eventName:"insertimage",iconCls:"fa fa-image"},media:{btnText:"\u70b9\u51fb\u9009\u62e9\u591a\u5a92\u4f53\u97f3\u89c6\u9891\u2026",eventName:"insertvideo",iconCls:"fa fa-film"},file:{btnText:"\u70b9\u51fb\u9009\u62e9\u6587\u4ef6\u4e0a\u4f20\u2026",eventName:"attachment",iconCls:"fa fa-folder-o"}},width:500,height:"auto",deleteable:!0,editable:!0,optPath:UEUPLOADER_PAHT||"js/ueuploader"},d,a);if(a.config[a.type])return a.config[a.type].btnText=a.btnText||a.config[a.type].btnText,d=b(this).attr("id"),a.El={editor:b("#"+d),id:d},b(this).html(""),l.call(this[0],a),this;console.error("type\x3d"+a.type+",\u7c7b\u578b\u9519\u8bef\uff0c\u7c7b\u578b\u5141\u8bb8[image\u3001media\u3001file]")};b.fn.ueuploader.methods={loadData:function(a){k.call(this,a)},getData:function(){return b.data(this,"data")},getValue:function(){var a=b.fn.ueuploader.methods.getData.call(this);if(void 0!=a&&null!=a&&0!=a.length){var c=[];b.each(a,function(a,b){c[a]={id:b.id,path:b.url,title:b.title}});return JSON.stringify(c)}return null},options:function(){return b.data(this,"uploader").options}}})(jQuery);