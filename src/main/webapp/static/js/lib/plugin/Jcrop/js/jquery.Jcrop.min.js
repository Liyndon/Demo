/**
 * jquery.Jcrop.js v0.9.12
 * jQuery Image Cropping Plugin - released under MIT License 
 * Author: Kelly Hallman <khallman@gmail.com>
 * http://github.com/tapmodo/Jcrop
 * Copyright (c) 2008-2013 Tapmodo Interactive LLC {{{
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * }}}
 */(function(f){f.Jcrop=function(B,w){function g(a){return Math.round(a)+"px"}function G(a){a=f(a).offset();return[a.left,a.top]}function C(a){return[a.pageX-J[0],a.pageY-J[1]]}function H(b){"object"!==typeof b&&(b={});a=f.extend(a,b);f.each(["onChange","onSelect","onRelease","onDblClick"],function(b,t){"function"!==typeof a[t]&&(a[t]=function(){})})}function fa(a,d,t){J=G(v);F.setCursor("move"===a?a:a+"-resize");if("move"===a)return F.activateHandlers(ua(d),Z,t);d=x.getFixed();var f=ga(a),c=x.getCorner(ga(f));x.setPressed(x.getCorner(f));x.setCurrent(c);F.activateHandlers(va(a,d),Z,t)}function va(b,d){return function(t){if(a.aspectRatio)switch(b){case "e":t[1]=d.y+1;break;case "w":t[1]=d.y+1;break;case "n":t[0]=d.x+1;break;case "s":t[0]=d.x+1}else switch(b){case "e":t[1]=d.y2;break;case "w":t[1]=d.y2;break;case "n":t[0]=d.x2;break;case "s":t[0]=d.x2}x.setCurrent(t);m.update()}}function ua(a){var d=a;aa.watchKeys();return function(a){x.moveOffset([a[0]-d[0],a[1]-d[1]]);d=a;m.update()}}function ga(a){switch(a){case "n":return"sw";case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function ia(b){return function(d){if(a.disabled||"move"===b&&!a.allowMove)return!1;J=G(v);N=!0;fa(b,C(d));d.stopPropagation();d.preventDefault();return!1}}function ja(a,d,t){var f=a.width(),c=a.height();f>d&&0<d&&(f=d,c=d/a.width()*a.height());c>t&&0<t&&(c=t,f=t/a.height()*a.width());y=a.width()/f;z=a.height()/c;a.width(f).height(c)}function S(a){return{x:a.x*y,y:a.y*z,x2:a.x2*y,y2:a.y2*z,w:a.w*y,h:a.h*z}}function Z(b){b=x.getFixed();b.w>a.minSelect[0]&&b.h>a.minSelect[1]?(m.enableHandles(),m.done()):m.release();F.setCursor(a.allowSelect?"crosshair":"default")}function ka(b){if(a.disabled||!a.allowSelect)return!1;N=!0;J=G(v);m.disableHandles();F.setCursor("crosshair");var d=C(b);x.setPressed(d);m.update();F.activateHandlers(wa,Z,"touch"===b.type.substring(0,5));aa.watchKeys();b.stopPropagation();b.preventDefault();return!1}function wa(a){x.setCurrent(a);m.update()}function la(){var b=f("\x3cdiv\x3e\x3c/div\x3e").addClass(a.baseClass+"-tracker");ma&&b.css({opacity:0,backgroundColor:"white"});return b}function na(b){oa([b[0]/y,b[1]/z,b[2]/y,b[3]/z]);a.onSelect.call(D,S(x.getFixed()));m.enableHandles()}function oa(a){x.setPressed([a[0],a[1]]);x.setCurrent([a[2],a[3]]);m.update()}function pa(){a.disabled=!0;m.disableHandles();m.setCursor("default");F.setCursor("default")}function qa(){a.disabled=!1;ba()}function ca(b,d,t){d=d||a.bgColor;a.bgFade&&f.fx.step.hasOwnProperty("backgroundColor")&&a.fadeTime&&!t?b.animate({backgroundColor:d},{queue:!1,duration:a.fadeTime}):b.css("backgroundColor",d)}function ba(b){a.allowResize?b?m.enableOnly():m.enableHandles():m.disableHandles();F.setCursor(a.allowSelect?"crosshair":"default");m.setCursor(a.allowMove?"move":"default");a.hasOwnProperty("trueSize")&&(y=a.trueSize[0]/r,z=a.trueSize[1]/h);a.hasOwnProperty("setSelect")&&(na(a.setSelect),m.done(),delete a.setSelect);K.refresh();a.bgColor!=ra&&(ca(a.shade?K.getShades():I,a.shade?a.shadeColor||a.bgColor:a.bgColor),ra=a.bgColor);T!=a.bgOpacity&&(T=a.bgOpacity,a.shade?K.refresh():m.setBgOpacity(T));U=a.maxSize[0]||0;V=a.maxSize[1]||0;W=a.minSize[0]||0;X=a.minSize[1]||0;a.hasOwnProperty("outerImage")&&(v.attr("src",a.outerImage),delete a.outerImage);m.refresh()};var a=f.extend({},f.Jcrop.defaults),J,O=navigator.userAgent.toLowerCase(),ma=/msie/.test(O),sa=/msie [1-6]\./.test(O);"object"!==typeof B&&(B=f(B)[0]);"object"!==typeof w&&(w={});H(w);var O={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},u=f(B),ta=!0;if("IMG"==B.tagName){if(0!=u[0].width&&0!=u[0].height)u.width(u[0].width),u.height(u[0].height);else{var da=new Image;da.src=u[0].src;u.width(da.width);u.height(da.height)}var v=u.clone().removeAttr("id").css(O).show();v.width(u.width());v.height(u.height());u.hide()}else v=u.css(O).show(),ta=!1,null===a.shade&&(a.shade=!0);ja(v,a.boxWidth,a.boxHeight);var r=v.width(),h=v.height(),I=f("\x3cdiv /\x3e").width(r).height(h).addClass(a.baseClass+"-holder").css({position:"relative",backgroundColor:a.bgColor}).insertAfter(u).append(v);a.addClass&&I.addClass(a.addClass);var L=f("\x3cdiv /\x3e"),Y=f("\x3cdiv /\x3e").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),P=f("\x3cdiv /\x3e").width("100%").height("100%").css("zIndex",320),Q=f("\x3cdiv /\x3e").css({position:"absolute",zIndex:600}).dblclick(function(){var b=x.getFixed();a.onDblClick.call(D,b)}).insertBefore(v).append(Y,P);ta&&(L=f("\x3cimg /\x3e").attr("src",v.attr("src")).css(O).width(r).height(h),Y.append(L));sa&&Q.css({overflowY:"hidden"});var R=a.boundary,M=la().width(r+2*R).height(h+2*R).css({position:"absolute",top:g(-R),left:g(-R),zIndex:290}).mousedown(ka),ra=a.bgColor,T=a.bgOpacity,U,V,W,X,y,z,N,ea,xa;J=G(v);var E=function(){function b(){var a={},b=["touchstart","touchmove","touchend"],c=document.createElement("div"),e;try{for(e=0;e<b.length;e++){var d=b[e],d="on"+d,k=d in c;k||(c.setAttribute(d,"return;"),k="function"==typeof c[d]);a[b[e]]=k}return a.touchstart&&a.touchend&&a.touchmove}catch(f){return!1}}var d;d=!0===a.touchSupport||!1===a.touchSupport?a.touchSupport:b();return{createDragger:function(b){return function(d){if(a.disabled||"move"===b&&!a.allowMove)return!1;J=G(v);N=!0;fa(b,C(E.cfilter(d)),!0);d.stopPropagation();d.preventDefault();return!1}},newSelection:function(a){return ka(E.cfilter(a))},cfilter:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return a},isSupported:b,support:d}}(),x=function(){function b(){if(!a.aspectRatio){var p=n-c,b=k-e;U&&Math.abs(p)>U&&(n=0<p?c+U:c-U);V&&Math.abs(b)>V&&(k=0<b?e+V:e-V);X/z&&Math.abs(b)<X/z&&(k=0<b?e+X/z:e-X/z);W/y&&Math.abs(p)<W/y&&(n=0<p?c+W/y:c-W/y);0>c&&(n-=c,c-=c);0>e&&(k-=e,e-=e);0>n&&(c-=n,n-=n);0>k&&(e-=k,k-=k);n>r&&(p=n-r,c-=p,n-=p);k>h&&(p=k-h,e-=p,k-=p);c>r&&(p=c-h,k-=p,e-=p);e>h&&(p=e-h,k-=p,e-=p);return m(f(c,e,n,k))}var p=a.aspectRatio,b=a.minSize[0]/y,d=a.maxSize[0]/y,g=n-c,A=k-e,q=Math.abs(g),l=Math.abs(A);0===d&&(d=10*r);q/l<p?(q=k,l*=p,l=0>g?c-l:l+c,0>l?(l=0,q=Math.abs((l-c)/p),q=0>A?e-q:q+e):l>r&&(l=r,q=Math.abs((l-c)/p),q=0>A?e-q:q+e)):(l=n,q/=p,q=0>A?e-q:e+q,0>q?(q=0,l=Math.abs((q-e)*p),l=0>g?c-l:l+c):q>h&&(q=h,l=Math.abs(q-e)*p,l=0>g?c-l:l+c));l>c?(l-c<b?l=c+b:l-c>d&&(l=c+d),q=q>e?e+(l-c)/p:e-(l-c)/p):l<c&&(c-l<b?l=c-b:c-l>d&&(l=c-d),q=q>e?e+(c-l)/p:e-(c-l)/p);0>l?(c-=l,l=0):l>r&&(c-=l-r,l=r);0>q?(e-=q,q=0):q>h&&(e-=q-h,q=h);return m(f(c,e,l,q))}function d(a){0>a[0]&&(a[0]=0);0>a[1]&&(a[1]=0);a[0]>r&&(a[0]=r);a[1]>h&&(a[1]=h);return[Math.round(a[0]),Math.round(a[1])]}function f(a,b,c,e){var d=a,q=c,l=b,k=e;c<a&&(d=c,q=a);e<b&&(l=e,k=b);return[d,l,q,k]}function m(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var c=0,e=0,n=0,k=0,A,g;return{flipCoords:f,setPressed:function(a){a=d(a);n=c=a[0];k=e=a[1]},setCurrent:function(a){a=d(a);A=a[0]-n;g=a[1]-k;n=a[0];k=a[1]},getOffset:function(){return[A,g]},moveOffset:function(a){var b=a[0];a=a[1];0>c+b&&(b-=b+c);0>e+a&&(a-=a+e);h<k+a&&(a+=h-(k+a));r<n+b&&(b+=r-(n+b));c+=b;n+=b;e+=a;k+=a},getCorner:function(a){var c=b();switch(a){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:b}}(),K=function(){function b(){return d(x.getFixed())}function d(a){p.top.css({left:g(a.x),width:g(a.w),height:g(a.y)});p.bottom.css({top:g(a.y2),left:g(a.x),width:g(a.w),height:g(h-a.y2)});p.right.css({left:g(a.x2),width:g(r-a.x2)});p.left.css({width:g(a.x)})}function t(){return f("\x3cdiv /\x3e").css({position:"absolute",backgroundColor:a.shadeColor||a.bgColor}).appendTo(u)}function ha(){A||(A=!0,u.insertBefore(v),b(),m.setBgOpacity(1,0,1),L.hide(),c(a.shadeColor||a.bgColor,1),m.isAwake()?n(a.bgOpacity,1):n(1,1))}function c(a,b){ca(k(),a,b)}function e(){A&&(u.remove(),L.show(),A=!1,m.isAwake()?m.setBgOpacity(a.bgOpacity,1,1):(m.setBgOpacity(1,1,1),m.disableHandles()),ca(I,0,1))}function n(b,c){A&&(a.bgFade&&!c?u.animate({opacity:1-b},{queue:!1,duration:a.fadeTime}):u.css({opacity:1-b}))}function k(){return u.children()}var A=!1,u=f("\x3cdiv /\x3e").css({position:"absolute",zIndex:240,opacity:0}),p={top:t(),left:t().height(h),right:t().height(h),bottom:t()};return{update:b,updateRaw:d,getShades:k,setBgColor:c,enable:ha,disable:e,resize:function(a,b){p.left.css({height:g(b)});p.right.css({height:g(b)})},refresh:function(){a.shade?ha():e();m.isAwake()&&n(a.bgOpacity)},opacity:n}}(),m=function(){function b(a,b){var c=f("\x3cdiv /\x3e").mousedown(ia(a)).css({cursor:a+"-resize",position:"absolute",zIndex:b}).addClass("ord-"+a);E.support&&c.bind("touchstart.jcrop",E.createDragger(a));P.append(c);return c}function d(a){var c;for(c=0;c<a.length;c++)b(a[c],u++).addClass("jcrop-dragbar")}function t(b){var c,e;for(e=0;e<b.length;e++){switch(b[e]){case "n":c="hline";break;case "s":c="hline bottom";break;case "e":c="vline right";break;case "w":c="vline"}var d=c,d=f("\x3cdiv /\x3e").css({position:"absolute",opacity:a.borderOpacity}).addClass(a.baseClass+"-"+d);Y.append(d)}}function m(c){var e;for(e=0;e<c.length;e++){var d=a.handleSize,k=b(c[e],u++).css({opacity:a.handleOpacity}).addClass(a.baseClass+"-handle");d&&k.width(d).height(d)}}function c(){var a=x.getFixed();x.setPressed([a.x,a.y]);x.setCurrent([a.x2,a.y2]);e()}function e(a){if(r)return n(a)}function n(c){var b=x.getFixed(),e=b.h;Q.width(Math.round(b.w)).height(Math.round(e));var e=b.x,d=b.y;a.shade||L.css({top:g(-d),left:g(-e)});Q.css({top:g(d),left:g(e)});a.shade&&K.updateRaw(b);r||(Q.show(),a.shade?K.opacity(T):k(T,!0),r=!0);c?a.onSelect.call(D,S(b)):a.onChange.call(D,S(b))}function k(b,c,e){if(r||c)a.bgFade&&!e?v.animate({opacity:b},{queue:!1,duration:a.fadeTime}):v.css("opacity",b)}function A(){y=!0;if(a.allowResize)return P.show(),!0}function h(){y=!1;P.hide()}function p(a){a?(ea=!0,h()):(ea=!1,A())}var r,u=370,y=!1;a.dragEdges&&f.isArray(a.createDragbars)&&d(a.createDragbars);f.isArray(a.createHandles)&&m(a.createHandles);a.drawBorders&&f.isArray(a.createBorders)&&t(a.createBorders);f(document).bind("touchstart.jcrop-ios",function(a){f(a.currentTarget).hasClass("jcrop-tracker")&&a.stopPropagation()});var z=la().mousedown(ia("move")).css({cursor:"move",position:"absolute",zIndex:360});E.support&&z.bind("touchstart.jcrop",E.createDragger("move"));Y.append(z);h();return{updateVisible:e,update:n,release:function(){h();Q.hide();a.shade?K.opacity(1):k(1);r=!1;a.onRelease.call(D)},refresh:c,isAwake:function(){return r},setCursor:function(a){z.css("cursor",a)},enableHandles:A,enableOnly:function(){y=!0},showHandles:function(){y&&P.show()},disableHandles:h,animMode:p,setBgOpacity:k,done:function(){p(!1);c()}}}(),F=function(){function b(a){c(C(a));return!1}function d(b){b.preventDefault();b.stopPropagation();N&&(N=!1,e(C(b)),m.isAwake()&&a.onSelect.call(D,S(x.getFixed())),M.css({zIndex:290}),f(document).unbind(".jcrop"),c=function(){},e=function(){});return!1}function t(a){c(C(E.cfilter(a)));return!1}function g(a){return d(E.cfilter(a))}var c=function(){},e=function(){},n=a.trackDocument;n||M.mousemove(b).mouseup(d).mouseout(d);v.before(M);return{activateHandlers:function(a,m,h){N=!0;c=a;e=m;M.css({zIndex:450});h?f(document).bind("touchmove.jcrop",t).bind("touchend.jcrop",g):n&&f(document).bind("mousemove.jcrop",b).bind("mouseup.jcrop",d);return!1},setCursor:function(a){M.css("cursor",a)}}}(),aa=function(){function b(a){g.hide()}function d(b,c,d){a.allowMove&&(x.moveOffset([c,d]),m.updateVisible(!0));b.preventDefault();b.stopPropagation()}function t(b){if(b.ctrlKey||b.metaKey)return!0;var c=(xa=b.shiftKey?!0:!1)?10:1;switch(b.keyCode){case 37:d(b,-c,0);break;case 39:d(b,c,0);break;case 38:d(b,0,-c);break;case 40:d(b,0,c);break;case 27:a.allowSelect&&m.release();break;case 9:return!0}return!1}var g=f('\x3cinput type\x3d"radio" /\x3e').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),c=f("\x3cdiv /\x3e").css({position:"absolute",overflow:"hidden"}).append(g);a.keySupport&&(g.keydown(t).blur(b),sa||!a.fixedSupport?(g.css({position:"absolute",left:"-20px"}),c.append(g).insertBefore(v)):g.insertBefore(v));return{watchKeys:function(){a.keySupport&&(g.show(),g.focus())}}}();E.support&&M.bind("touchstart.jcrop",E.newSelection);P.hide();ba(!0);var D={setImage:function(b,d){m.release();pa();var f=new Image;f.onload=function(){var g=f.height,c=a.boxWidth,e=a.boxHeight;v.width(f.width).height(g);v.attr("src",b);L.attr("src",b);ja(v,c,e);r=v.width();h=v.height();L.width(r).height(h);M.width(r+2*R).height(h+2*R);I.width(r).height(h);K.resize(r,h);qa();"function"===typeof d&&d.call(D)};f.src=b},animateTo:function(b,d){var f=b[0]/y,g=b[1]/z,c=b[2]/y,e=b[3]/z;if(!ea){var n=x.flipCoords(f,g,c,e),k=x.getFixed(),h=[k.x,k.y,k.x2,k.y2],r=a.animationDelay,p=n[0]-h[0],u=n[1]-h[1],v=n[2]-h[2],B=n[3]-h[3],w=0,q=a.swingSpeed,f=h[0],g=h[1],c=h[2],e=h[3];m.animMode(!0);var l=function(){return function(){w+=(100-w)/q;h[0]=Math.round(f+w/100*p);h[1]=Math.round(g+w/100*u);h[2]=Math.round(c+w/100*v);h[3]=Math.round(e+w/100*B);99.8<=w&&(w=100);100>w?(oa(h),window.setTimeout(l,r)):(m.done(),m.animMode(!1),"function"===typeof d&&d.call(D))}}();window.setTimeout(l,r)}},setSelect:na,setOptions:function(a){H(a);ba()},tellSelect:function(){return S(x.getFixed())},tellScaled:function(){return x.getFixed()},setClass:function(b){I.removeClass().addClass(a.baseClass+"-holder").addClass(b)},disable:pa,enable:qa,cancel:function(){m.done();F.activateHandlers(null,null)},release:m.release,destroy:function(){I.remove();u.show();u.css("visibility","visible");f(B).removeData("Jcrop")},focus:aa.watchKeys,getBounds:function(){return[r*y,h*z]},getWidgetSize:function(){return[r,h]},getScaleFactor:function(){return[y,z]},getOptions:function(){return a},ui:{holder:I,selection:Q}};ma&&I.bind("selectstart",function(){return!1});u.data("Jcrop",D);return D};f.fn.Jcrop=function(B,w){var g;this.each(function(){if(f(this).data("Jcrop")){if("api"===B)return f(this).data("Jcrop");f(this).data("Jcrop").setOptions(B)}else"IMG"==this.tagName?f.Jcrop.Loader(this,function(){f(this).css({display:"block",visibility:"visible"});g=f.Jcrop(this,B);f.isFunction(w)&&w.call(g)}):(f(this).css({display:"block",visibility:"hidden"}),g=f.Jcrop(this,B),f.isFunction(w)&&w.call(g))});return this};f.Jcrop.Loader=function(B,w,g){function G(){H.complete?(C.unbind(".jcloader"),f.isFunction(w)&&w.call(H)):window.setTimeout(G,50)}var C=f(B),H=C[0];C.bind("load.jcloader",G).bind("error.jcloader",function(w){C.unbind(".jcloader");f.isFunction(g)&&g.call(H)});H.complete&&f.isFunction(w)&&(C.unbind(".jcloader"),w.call(H))};f.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);